Sub Sample1()
    Dim i As Long
    Dim j As Long
    Dim k As Long
    Dim l As Long
    
    Dim seatr As Integer
    Dim seatc As Integer
    
    Dim cc As Integer
    Dim studentn As Long
    Dim classn As Long
    Dim a As Integer
    Dim classlist As Range
    Dim frslt As Range
    Dim nowclasscode As Integer
    Dim nowclassroom As Integer
    Dim classroomtemp As Range
    Dim classroomn As Integer
    Dim classroomConfig As Range
    Dim roomn As Integer
    
    Dim ofc As Integer
    Dim ofr As Integer
    
    Dim stc As Integer
    Dim str As Integer
    Dim stl As Integer
    Dim stw As Integer
    
    ofr = 2
    ofc = 0
    
      
    studentn = Worksheets("Sheet2").Range("A1").End(xlDown).Row
    a = 1
    classroomn = Worksheets("Sheet1").Range("A1").End(xlDown).Row
    seatr = 5
    seatc = 6
    roomn = Worksheets("Config").Range("A1").End(xlDown).Row
    
    
   
    Worksheets("Temp1").Activate
    Set classlist = Worksheets("Temp1").Range(Cells(1, 1), Cells(a, 1))
    For i = 2 To studentn - 1                    ''セルA2からセルA8までを処理する
        If Worksheets("Sheet2").Cells(i, 2).Value = "本郷" Then
            cc = Worksheets("Sheet2").Cells(i, 3).Value         ''セルの値を変数bufに格納する　授業コードの列
            
            Set frslt = classlist.Find(cc)
            If frslt Is Nothing Then   ''まだ登録されていなかったら…
                a = a + 1
                Worksheets("Temp1").Cells(a, 1).Value = cc            ''セルの値を連想配列に登録する
                Set classlist = Worksheets("Temp1").Range(Cells(1, 1), Cells(a, 1))
            End If
        End If
    Next i
    
    classn = Worksheets("Temp1").Range("A1").End(xlDown).Row
    classn = classn - 1
    
    For i = 1 To classn
         nowclasscode = Worksheets("Temp1").Cells(i + 1, 1)
         Worksheets("Sheet1").Activate
         Set classroomtemp = Worksheets("Sheet1").Range(Cells(1, 1), Cells(classroomn, 1)).Find(nowclasscode, LookAt:=xlWhole)
         If classroomtemp Is Nothing Then
            MsgBox ("時間割に登録されていない授業コードがあります")
         Else
            nowclassroom = Worksheets("Sheet1").Cells(classroomtemp.Row, 2).Value
         End If
         
         
         Worksheets("Config").Activate
         
         Set classroomConfig = Worksheets("Config").Range(Cells(1, 1), Cells(roomn, 1)).Find(nowclassroom, LookAt:=xlWhole)
         If classroomConfig Is Nothing Then
            MsgBox ("教室設定リストに該当の教室が存在しません")
         Else
            seatr = Worksheets("Config").Cells(classroomConfig.Row, 2).Value
            seatc = Worksheets("Config").Cells(classroomConfig.Row, 3).Value
            
            
         End If
         
         
         '座席表ベース作成
         Worksheets.Add after:=Worksheets(Worksheets.Count)
         ActiveSheet.Name = nowclasscode
         For j = 1 To seatc
            For k = 1 To seatr
                    Range(Cells(4 * k + ofr, 3 * j + ofc), Cells(4 * k + 2 + ofr, 3 * j + ofc)).BorderAround Weight:=xlMedium
                    Range(Cells(4 * k + ofr, 3 * j + 1 + ofc), Cells(4 * k + 2 + ofr, 3 * j + 1 + ofc)).BorderAround Weight:=xlMedium
            Next k
         Next j

         If nowclassroom = 401 Then
            For j = 1 To seatc
                For k = seatr + 1 To seatr + seatc - 1
                    
                    Range(Cells(4 * k + ofr, 3 * j + ofc), Cells(4 * k + 2 + ofr, 3 * j + ofc)).BorderAround Weight:=xlMedium
                    Range(Cells(4 * k + ofr, 3 * j + 1 + ofc), Cells(4 * k + 2 + ofr, 3 * j + 1 + ofc)).BorderAround Weight:=xlMedium
                Next k
                seatc = seatc - 1
            Next j
         End If
         
         
         Worksheets(Worksheets.Count).Cells(1, 1).Value = nowclasscode
         Worksheets(Worksheets.Count).Cells(1, 2).Value = nowclassroom
         
         '生徒入力
         str = 2
         stc = 2
         stl = 0
         stw = 0
         Worksheets("Sheet2").Activate
         For j = 1 To studentn
            If Worksheets("Sheet2").Cells(j, 2).Value = "本郷" And Worksheets("Sheet2").Cells(j, 3).Value = nowclasscode Then
                stl = stl Mod 2
                Worksheets(Worksheets.Count).Cells(4 * str + ofr, 3 * stc + ofc + stl).Value = Worksheets("Sheet2").Cells(j, 1).Value
                Worksheets(Worksheets.Count).Cells(4 * str + ofr + 1, 3 * stc + ofc + stl).Value = Worksheets("Sheet2").Cells(j, 4).Value
                Worksheets(Worksheets.Count).Cells(4 * str + ofr + 2, 3 * stc + ofc + stl).Value = Worksheets("Sheet2").Cells(j, 5).Value
                If stc = seatc - 1 Then
                    stc = 2
                    If str = seatr Then
                        str = 2
                        stw = stw + 1
                        If seatr Mod 2 = 1 Then
                            stl = stl + 1
                        End If
                        If stw = 2 Then
                            MsgBox ("生徒数がいっぱいです。残りの生徒は手入力してください。")
                            Exit For
                        End If
                    Else
                    str = str + 1
                    stl = stl + 1
                    End If
                Else
                    stc = stc + 1
                End If
            End If
         Next j
    Next i
    
End Sub